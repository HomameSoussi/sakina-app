# 🚀 Quick Deployment Guide for Sakina

This guide will help you deploy the Sakina app to production in just a few steps.

## 📋 Prerequisites

Before deploying, make sure you have:

- [x] **GitHub account** (already connected)
- [ ] **Supabase account** - Sign up at [supabase.com](https://supabase.com)
- [ ] **Vercel account** - Sign up at [vercel.com](https://vercel.com)
- [ ] **Stripe account** (optional) - For payments at [stripe.com](https://stripe.com)
- [ ] **Node.js 18+** and **pnpm** installed locally

## 🏗️ Step 1: Set Up Supabase Backend

### 1.1 Get Supabase Access Token

1. Go to [Supabase Dashboard](https://supabase.com/dashboard)
2. Click on your profile → **Access Tokens**
3. Generate a new token with **Full Access**
4. Copy the token

### 1.2 Deploy Supabase Backend

```bash
# Set your Supabase access token
export SUPABASE_ACCESS_TOKEN=your_token_here

# Run the deployment script
./scripts/deploy-supabase.sh
```

This script will:
- ✅ Create a new Supabase project
- ✅ Deploy database schema and RLS policies
- ✅ Seed initial content and anxiety relief data
- ✅ Deploy Edge Functions (prayer times, Quran API, Stripe)
- ✅ Generate TypeScript types
- ✅ Save credentials to `.env.local`

## 🌐 Step 2: Deploy Web App to Vercel

### 2.1 Deploy to Vercel

```bash
# Run the Vercel deployment script
./scripts/deploy-vercel.sh
```

This script will:
- ✅ Install Vercel CLI if needed
- ✅ Build the web app
- ✅ Deploy to Vercel
- ✅ Set environment variables
- ✅ Configure custom domain (optional)

### 2.2 Manual Vercel Setup (Alternative)

If you prefer manual setup:

```bash
# Install Vercel CLI
npm install -g vercel

# Login to Vercel
vercel login

# Deploy from web app directory
cd apps/web
vercel --prod
```

## 📱 Step 3: Build Mobile Apps

### 3.1 Set Up Expo Account

1. Sign up at [expo.dev](https://expo.dev)
2. Install EAS CLI: `npm install -g @expo/eas-cli`
3. Login: `eas login`

### 3.2 Configure Mobile App

```bash
# Navigate to mobile app
cd apps/mobile

# Configure EAS
eas build:configure

# Update app.json with your details
```

### 3.3 Build for iOS and Android

```bash
# Build for iOS
eas build --platform ios --profile production

# Build for Android  
eas build --platform android --profile production

# Submit to app stores
eas submit --platform ios
eas submit --platform android
```

## 🔧 Step 4: Configure External APIs

### 4.1 Stripe Setup (Optional)

1. Create account at [stripe.com](https://stripe.com)
2. Get API keys from Dashboard → Developers → API Keys
3. Add to `.env.local`:

```env
VITE_STRIPE_PUBLISHABLE_KEY=pk_live_...
STRIPE_SECRET_KEY=sk_live_...
```

### 4.2 External API Keys

Add these to your `.env.local`:

```env
# Prayer Times (Aladhan API - no key needed for basic usage)
ALADHAN_API_URL=https://api.aladhan.com/v1

# Quran API (optional - for enhanced features)
QURAN_API_KEY=your_quran_api_key
QURAN_API_URL=https://api.quran.com/api/v4
```

## 🔒 Step 5: Security & Environment Variables

### 5.1 Complete .env.local File

Your `.env.local` should look like this:

```env
# Supabase (auto-generated by deployment script)
VITE_SUPABASE_URL=https://your-project.supabase.co
VITE_SUPABASE_ANON_KEY=your-anon-key
SUPABASE_PROJECT_ID=your-project-id
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_ANON_KEY=your-anon-key

# Vercel (auto-generated by deployment script)
VERCEL_URL=https://your-app.vercel.app

# Stripe (add manually)
VITE_STRIPE_PUBLISHABLE_KEY=pk_live_...
STRIPE_SECRET_KEY=sk_live_...
STRIPE_WEBHOOK_SECRET=whsec_...

# External APIs (optional)
ALADHAN_API_URL=https://api.aladhan.com/v1
QURAN_API_KEY=your_quran_api_key
QURAN_API_URL=https://api.quran.com/api/v4
```

### 5.2 Set Vercel Environment Variables

In your Vercel dashboard:
1. Go to Project Settings → Environment Variables
2. Add all `VITE_*` variables for production

## 📊 Step 6: Monitoring & Analytics

### 6.1 Supabase Monitoring

- **Database**: Monitor in Supabase Dashboard → Database
- **API Usage**: Check API logs and performance
- **Storage**: Monitor file uploads and bandwidth

### 6.2 Vercel Analytics

- **Performance**: Enable Web Analytics in Vercel
- **Errors**: Monitor function logs and errors
- **Traffic**: Track page views and user sessions

## 🧪 Step 7: Testing Deployment

### 7.1 Test Web App

1. Visit your Vercel URL
2. Test panic button functionality
3. Try mood check-in feature
4. Test audio library
5. Verify Islamic content (if enabled)

### 7.2 Test Mobile App

1. Install test build on device
2. Test offline functionality
3. Verify push notifications
4. Test authentication flow

## 🚀 Step 8: Go Live!

### 8.1 App Store Submission

**iOS App Store:**
1. Complete App Store Connect setup
2. Upload build via EAS Submit
3. Fill out app information and screenshots
4. Submit for review

**Google Play Store:**
1. Complete Google Play Console setup
2. Upload APK/AAB via EAS Submit
3. Fill out store listing
4. Submit for review

### 8.2 Marketing & Launch

1. **Website SEO**: Optimize meta tags and content
2. **Social Media**: Prepare launch posts
3. **Community**: Engage with Muslim mental health communities
4. **Press**: Reach out to Islamic and mental health publications

## 🔧 Troubleshooting

### Common Issues

**Supabase Connection Error:**
```bash
# Check your environment variables
cat .env.local

# Test Supabase connection
curl -H "apikey: $VITE_SUPABASE_ANON_KEY" "$VITE_SUPABASE_URL/rest/v1/"
```

**Vercel Build Error:**
```bash
# Check build logs in Vercel dashboard
# Ensure all environment variables are set
# Verify package.json scripts
```

**Mobile Build Error:**
```bash
# Check EAS build logs
eas build:list

# Verify app.json configuration
# Check for missing dependencies
```

### Getting Help

- **GitHub Issues**: [Report bugs](https://github.com/HomameSoussi/sakina-app/issues)
- **Supabase Docs**: [supabase.com/docs](https://supabase.com/docs)
- **Vercel Docs**: [vercel.com/docs](https://vercel.com/docs)
- **Expo Docs**: [docs.expo.dev](https://docs.expo.dev)

## 📈 Post-Launch Checklist

- [ ] Monitor error rates and performance
- [ ] Collect user feedback and reviews
- [ ] Plan feature updates and improvements
- [ ] Scale infrastructure as needed
- [ ] Engage with user community
- [ ] Measure mental health impact

## 🤲 Final Notes

**Sakina** (سَكِينَة) means "tranquility" in Arabic - may this app bring peace to all who use it.

Remember to:
- Keep Islamic content authentic and respectful
- Prioritize user privacy and data security
- Maintain high standards for mental health content
- Engage with both Muslim and broader mental health communities

**May Allah bless your efforts in helping others find peace and tranquility! 🌙✨**

---

*"And it is He who sent down tranquility (sakina) into the hearts of the believers..."* - Quran 48:4
